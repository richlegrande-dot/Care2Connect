'use client'\n\nimport { useState } from 'react'\nimport Link from 'next/link'\n\nconst donationPlatforms = [\n  { id: 'careconnect', name: 'CareConnect Page', placeholder: 'your-unique-slug', icon: 'üè†', generateUrl: true },\n  { id: 'cashapp', name: 'Cash App', placeholder: 'https://cash.app/$username', icon: 'üíµ' },\n  { id: 'venmo', name: 'Venmo', placeholder: 'https://venmo.com/username', icon: 'üíô' },\n  { id: 'paypal', name: 'PayPal', placeholder: 'https://paypal.me/username', icon: 'üÖøÔ∏è' },\n  { id: 'zelle', name: 'Zelle', placeholder: 'your-email@example.com', icon: '‚ö°' },\n  { id: 'custom', name: 'Custom Link', placeholder: 'https://your-donation-link.com', icon: 'üîó' }\n]\n\nexport default function QRGeneratorPage() {\n  const [selectedPlatform, setSelectedPlatform] = useState('')\n  const [donationUrl, setDonationUrl] = useState('')\n  const [qrCodeUrl, setQrCodeUrl] = useState('')\n  const [isGenerating, setIsGenerating] = useState(false)\n\n  const generateQR = async () => {\n    if (!donationUrl.trim()) return\n    \n    setIsGenerating(true)\n    \n    try {\n      // If CareConnect platform, construct the full URL\n      let finalUrl = donationUrl\n      if (selectedPlatform === 'careconnect') {\n        finalUrl = `http://localhost:3000/donate/${donationUrl}`\n      }\n      \n      const response = await fetch('http://localhost:3001/api/donations/qr', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          donation_url: finalUrl\n        })\n      })\n      \n      if (response.ok) {\n        const result = await response.json()\n        setQrCodeUrl(result.qr_code_url)\n      } else {\n        alert('Failed to generate QR code. Please try again.')\n      }\n    } catch (error) {\n      console.error('Error generating QR code:', error)\n      alert('Error generating QR code. Make sure the backend server is running.')\n    } finally {\n      setIsGenerating(false)\n    }\n  }\n\n  const downloadQR = () => {\n    if (qrCodeUrl) {\n      const link = document.createElement('a')\n      link.href = qrCodeUrl\n      link.download = 'donation-qr-code.png'\n      link.click()\n    }\n  }\n\n  const selectedPlatformData = donationPlatforms.find(p => p.id === selectedPlatform)\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <div className=\"card\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">\n          üì± QR Code Generator\n        </h1>\n        <p className=\"text-gray-600 mb-8\">\n          Generate QR codes for your donation links. People can scan these codes with their phones to donate instantly.\n        </p>\n\n        {/* Platform Selection */}\n        <div className=\"mb-6\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n            Choose donation platform\n          </label>\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n            {donationPlatforms.map((platform) => (\n              <button\n                key={platform.id}\n                onClick={() => {\n                  setSelectedPlatform(platform.id)\n                  setDonationUrl('')\n                  setQrCodeUrl('')\n                }}\n                className={`p-3 rounded-lg border-2 text-center transition-colors ${\n                  selectedPlatform === platform.id\n                    ? 'border-blue-500 bg-blue-50' \n                    : 'border-gray-200 bg-white hover:border-gray-300'\n                }`}\n              >\n                <div className=\"text-xl mb-1\">{platform.icon}</div>\n                <div className=\"text-sm font-medium\">{platform.name}</div>\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* URL Input */}\n        {selectedPlatform && (\n          <div className=\"mb-6\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              {selectedPlatform === 'careconnect' ? 'Your unique slug *' : `${selectedPlatformData?.name} donation link *`}\n            </label>\n            {selectedPlatform === 'careconnect' && (\n              <div className=\"mb-2 p-3 bg-gray-50 rounded border\">\n                <p className=\"text-sm text-gray-600\">Your donation page will be:</p>\n                <p className=\"font-mono text-sm text-blue-600\">\n                  http://localhost:3000/donate/{donationUrl || 'your-slug'}\n                </p>\n              </div>\n            )}\n            <input\n              type=\"text\"\n              value={donationUrl}\n              onChange={(e) => setDonationUrl(e.target.value)}\n              placeholder={selectedPlatformData?.placeholder}\n              className=\"form-input\"\n            />\n            <p className=\"text-xs text-gray-500 mt-1\">\n              {selectedPlatform === 'careconnect' \n                ? 'Enter a unique identifier (letters, numbers, dashes only)'\n                : 'Enter your complete donation link or identifier'\n              }\n            </p>\n          </div>\n        )}\n\n        {/* Generate Button */}\n        {donationUrl && (\n          <div className=\"text-center mb-6\">\n            <button\n              onClick={generateQR}\n              disabled={isGenerating}\n              className={`btn-primary ${isGenerating ? 'opacity-50 cursor-not-allowed' : ''}`}\n            >\n              {isGenerating ? '‚è≥ Generating...' : 'üì± Generate QR Code'}\n            </button>\n          </div>\n        )}\n\n        {/* QR Code Result */}\n        {qrCodeUrl && (\n          <div className=\"bg-green-50 rounded-lg p-6 text-center\">\n            <h3 className=\"font-medium text-green-900 mb-4\">‚úÖ QR Code Generated!</h3>\n            <div className=\"bg-white p-4 rounded-lg inline-block shadow-sm mb-4\">\n              <img src={qrCodeUrl} alt=\"Donation QR Code\" className=\"w-48 h-48 mx-auto\" />\n            </div>\n            <div className=\"space-x-3\">\n              <button onClick={downloadQR} className=\"btn-primary\">\n                üíæ Download QR Code\n              </button>\n              <button \n                onClick={() => {\n                  setQrCodeUrl('')\n                  setDonationUrl('')\n                }}\n                className=\"btn-secondary\"\n              >\n                üîÑ Generate Another\n              </button>\n            </div>\n            <p className=\"text-sm text-green-800 mt-3\">\n              People can scan this code with their phone camera to donate instantly!\n            </p>\n          </div>\n        )}\n\n        {/* Usage Tips */}\n        <div className=\"bg-blue-50 rounded-lg p-4 mb-6\">\n          <h3 className=\"font-medium text-blue-900 mb-2\">üí° QR Code Tips:</h3>\n          <ul className=\"text-sm text-blue-800 space-y-1\">\n            <li>‚Ä¢ Print QR codes on signs, flyers, or business cards</li>\n            <li>‚Ä¢ Test your QR code before sharing to ensure it works</li>\n            <li>‚Ä¢ Include a short explanation: \"Scan to donate\"</li>\n            <li>‚Ä¢ Make sure the QR code is large enough to scan easily</li>\n          </ul>\n        </div>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between items-center pt-6 border-t\">\n          <Link href=\"/\" className=\"btn-secondary\">\n            ‚Üê Back to Home\n          </Link>\n          \n          <Link href=\"/gfm/1-location\" className=\"btn-primary\">\n            Create GoFundMe Draft ‚Üí\n          </Link>\n        </div>\n      </div>\n    </div>\n  )\n}