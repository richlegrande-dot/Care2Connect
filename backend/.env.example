# =============================================================================
# CareConnect Backend Environment Variables
# Copy this file to .env and fill in your actual values
# SECURITY: Never commit actual secrets to git
# =============================================================================

# =============================================
# DEMO / OPEN-TESTING MINIMUM REQUIRED KEYS
# =============================================
# These must be set for ANY environment to start correctly:
#
#   NODE_ENV=development          (or production)
#   PORT=3001
#   DATABASE_URL=postgresql://user:pass@localhost:5432/careconnect
#   JWT_SECRET=<at-least-32-characters>
#
# With these four keys + V1_STABLE defaults below, the server will start.

# =============================================================================
# CORE APPLICATION SETTINGS
# =============================================================================

# Runtime Environment
NODE_ENV=development                # development | production | test
RUN_MODE=dev                        # dev | prod (explicit runtime mode)
PORT=3001

# Security -- CHANGE THESE IN YOUR .env
JWT_SECRET=your-super-secret-jwt-key-minimum-32-characters-required-for-security
SYSTEM_PANEL_PASSWORD=blueberry:y22
SESSION_SECRET=your_session_secret_here

# =============================================================================
# V1 STABLE MODE FLAGS (REQUIRED FOR PRODUCTION)
# =============================================================================

# V1 Stable Mode -- enforces production-ready configuration
V1_STABLE=true

# Zero OpenAI Mode -- disables all OpenAI API calls (V1 requirement)
ZERO_OPENAI_MODE=true

# AI Provider -- use 'rules' for deterministic rules-based processing
# Options: rules | none | openai (openai not allowed in V1)
AI_PROVIDER=rules

# Transcription Provider -- AssemblyAI or stub for testing
# Options: assemblyai | stub | openai (openai not allowed in V1)
TRANSCRIPTION_PROVIDER=assemblyai

# =============================================================================
# V2 INTAKE WIZARD
# =============================================================================

# When true, /api/v2/intake/* endpoints are active
ENABLE_V2_INTAKE=false
# When true, V2 endpoints require Bearer token auth
ENABLE_V2_INTAKE_AUTH=true

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# Database Mode
# DB_MODE=local   -> Use Docker PostgreSQL on localhost (recommended for dev)
# DB_MODE=remote  -> Use cloud/remote database (for production deployments)
DB_MODE=local

# Database URL
# For local:  postgresql://username:password@localhost:5432/careconnect
# For remote: postgresql://user:pass@db.prisma.io:5432/postgres
# DATABASE_URL=postgresql://username:password@localhost:5432/careconnect

# =============================================================================
# CORS & FRONTEND URL
# =============================================================================

FRONTEND_URL=https://care2connects.org
CORS_ORIGIN=http://localhost:3000

# =============================================================================
# HEALTH CHECKS
# =============================================================================

HEALTHCHECKS_ENABLED=true
HEALTHCHECKS_INTERVAL_SEC=300
HEALTH_CHECK_INTERVAL=30000
EXTERNAL_SERVICE_TIMEOUT=5000

# =============================================================================
# THIRD-PARTY API KEYS (optional -- leave blank to use stubs)
# =============================================================================
# SECURITY: Do NOT paste real keys into PRs or chat. Use local .env only.

# OpenAI (V2-ONLY -- not used when V1_STABLE=true or ZERO_OPENAI_MODE=true)
# OPENAI_API_KEY=

# AssemblyAI (required for audio transcription)
# ASSEMBLYAI_API_KEY=

# Stripe (donations + webhook verification)
# Use test keys for local development (sk_test_..., pk_test_..., whsec_...)
# STRIPE_SECRET_KEY=
# STRIPE_PUBLISHABLE_KEY=
# STRIPE_WEBHOOK_SECRET=

# GoFundMe API (if integrating directly)
# GOFUNDME_API_KEY=
# GOFUNDME_API_SECRET=

# =============================================================================
# FILE UPLOADS & STORAGE
# =============================================================================

MAX_FILE_SIZE=10485760
ALLOWED_FILE_TYPES=audio/wav,audio/mp3,audio/webm,audio/ogg
STORAGE_PROVIDER=local
STORAGE_PATH=./uploads

# =============================================================================
# API RATE LIMITING
# =============================================================================

RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
DISABLE_RATE_LIMITING=false

# =============================================================================
# LOGGING
# =============================================================================

LOG_LEVEL=info

# =============================================================================
# DEMO & DATA PROTECTION
# =============================================================================

DEMO_MODE=false
BLOCK_SENSITIVE_DATA=true
REQUIRE_CONSENT=true

# =============================================================================
# QR CODE CONFIGURATION
# =============================================================================

QR_CODE_SIZE=200
QR_CODE_MARGIN=4
QR_CODE_ERROR_LEVEL=M

# =============================================================================
# DOCUMENT EXPORT
# =============================================================================

EXPORT_TEMPLATE_PATH=./templates
DEFAULT_FONT_FAMILY="Arial"
DEFAULT_FONT_SIZE=12

# =============================================================================
# TRANSCRIPTION (ADVANCED)
# =============================================================================

# EVTS (on-device) -- run: cd backend && npm run evts:model:install
# If not installed, falls back to browser NVT or manual workflow.
TRANSCRIPTION_MODE=legacy
# Options: legacy (API-based), nvt (Web Speech API), evts (offline)
# EVTS_ENGINE=whispercpp
# EVTS_MODEL_PATH=./models/whisper.cpp/ggml-base.en.bin
TRANSCRIPTION_LANGUAGE=en-US

# =============================================================================
# PIPELINE TIMEOUTS & RETRY (Phase 6C)
# =============================================================================

# Stage timeouts (milliseconds)
TRANSCRIPTION_TIMEOUT=120000          # 2 min for AssemblyAI
ANALYSIS_TIMEOUT=10000                # 10s for keyword extraction
DRAFT_GENERATION_TIMEOUT=15000        # 15s for draft creation
QR_GENERATION_TIMEOUT=10000           # 10s for QR + Stripe
PIPELINE_TOTAL_TIMEOUT=180000         # 3 min total pipeline

# Retry settings
MAX_RETRY_ATTEMPTS=3
RETRY_INITIAL_DELAY=2000              # 2s
RETRY_MAX_DELAY=30000                 # 30s
RETRY_BACKOFF_MULTIPLIER=2

# Circuit breaker settings
CIRCUIT_BREAKER_THRESHOLD=5           # Failures before circuit opens
CIRCUIT_BREAKER_RESET_TIMEOUT=60000   # 1 min before trying again

# =============================================================================
# LEGACY / OPTIONAL FLAGS
# =============================================================================

ALLOW_SYSTEM_COMMANDS=false
KEYS_MANUAL_CONFIRM=true
# KEYS_VALIDATED=true
# NO_KEYS_MODE=true
# DEMO_SAFE_MODE=false
# PUBLIC_URL=https://example.com

# Development/Testing mocks
MOCK_OPENAI_RESPONSES=false
MOCK_STRIPE_RESPONSES=false

# Support tickets (stored locally in data/support-tickets, no SMTP)
SUPPORT_EMAIL_TO=workflown8n@gmail.com
