(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[675],{83080:function(e,t,s){Promise.resolve().then(s.bind(s,1051))},1051:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var r=s(37821),a=s(58078),n=s(46179),i=s(39052);function d(e){let{params:t}=e,s=(0,n.useRouter)(),[d,l]=(0,a.useState)(null),[o,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{m()},[t.auditId]);let m=async()=>{c(!0);try{let e=localStorage.getItem("adminToken"),r=await fetch("/api/admin/knowledge/audit/".concat(t.auditId),{headers:{Authorization:"Bearer ".concat(e)}});if(r.ok){let e=await r.json();l(e)}else 404===r.status&&(alert("Audit log not found"),s.push("/admin/knowledge/audit"))}catch(e){console.error("Error fetching audit log:",e)}finally{c(!1)}};return o?(0,r.jsx)(i.t,{children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading audit log..."})]})})}):d?(0,r.jsx)(i.t,{children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,r.jsx)("button",{onClick:()=>s.push("/admin/knowledge/audit"),className:"text-sm text-blue-600 hover:text-blue-700 mb-2 flex items-center",children:"â† Back to Audit Logs"}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Audit Log Detail"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d.id})]})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow mb-6 p-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"Action"}),(0,r.jsx)("div",{className:"inline-block px-3 py-1 rounded-md border font-semibold ".concat((e=>{switch(e){case"CREATE":return"text-green-600 bg-green-50 border-green-200";case"UPDATE":return"text-blue-600 bg-blue-50 border-blue-200";case"DELETE":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}})(d.action)),children:d.action})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"Entity Type"}),(0,r.jsx)("div",{className:"text-gray-900 font-medium",children:d.entityType.replace("_"," ")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"Actor"}),(0,r.jsx)("div",{className:"text-gray-900 font-medium",children:d.actor})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"Timestamp"}),(0,r.jsx)("div",{className:"text-gray-900 font-medium",children:new Date(d.createdAt).toLocaleString()})]})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"Entity ID"}),(0,r.jsx)("div",{className:"text-gray-900 font-mono text-sm",children:d.entityId}),d.relatedEntity&&(0,r.jsx)("button",{onClick:()=>{"KNOWLEDGE_SOURCE"===d.entityType&&s.push("/admin/knowledge/".concat(d.entityId))},className:"mt-2 text-blue-600 hover:text-blue-700 text-sm underline",children:"View Entity"})]}),d.reason&&(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"Reason"}),(0,r.jsx)("div",{className:"text-gray-900",children:d.reason})]})]}),"UPDATE"===d.action&&d.diffJson&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow mb-6 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Changes"}),(0,r.jsx)("div",{className:"space-y-4",children:Object.entries(d.diffJson).map(e=>{let[t,s]=e;return(0,r.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:t}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Before"}),(0,r.jsx)("pre",{className:"bg-red-50 border border-red-200 rounded p-2 text-sm overflow-x-auto",children:JSON.stringify(s.before,null,2)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"After"}),(0,r.jsx)("pre",{className:"bg-green-50 border border-green-200 rounded p-2 text-sm overflow-x-auto",children:JSON.stringify(s.after,null,2)})]})]})]},t)})})]}),"CREATE"!==d.action&&d.beforeJson&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow mb-6 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Before State"}),(0,r.jsx)("pre",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-sm overflow-x-auto",children:JSON.stringify(d.beforeJson,null,2)})]}),"DELETE"!==d.action&&d.afterJson&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow mb-6 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"After State"}),(0,r.jsx)("pre",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-sm overflow-x-auto",children:JSON.stringify(d.afterJson,null,2)})]})]})]})}):(0,r.jsx)(i.t,{children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-600",children:"Audit log not found"}),(0,r.jsx)("button",{onClick:()=>s.push("/admin/knowledge/audit"),className:"mt-4 text-blue-600 hover:text-blue-700 underline",children:"Back to Audit Logs"})]})})})}},39052:function(e,t,s){"use strict";s.d(t,{t:function(){return i}});var r=s(37821),a=s(58078),n=s(46179);function i(e){let{children:t}=e,[s,i]=(0,a.useState)(!1),[d,l]=(0,a.useState)(!0),[o,c]=(0,a.useState)(""),[m,x]=(0,a.useState)("");(0,n.useRouter)(),(0,a.useEffect)(()=>{let e=localStorage.getItem("adminToken");e?u(e):l(!1)},[]);let u=async e=>{try{let t=await fetch("/api/admin/db/connection-info",{headers:{Authorization:"Bearer ".concat(e)}});t.ok?i(!0):localStorage.removeItem("adminToken")}catch(e){i(!0)}finally{l(!1)}},h=async e=>{e.preventDefault(),x("");try{let e=await fetch("/api/admin/db/connection-info",{headers:{Authorization:"Bearer ".concat(o)}});e.ok?(localStorage.setItem("adminToken",o),i(!0),c("")):x("Invalid admin password")}catch(e){x("Authentication failed - server may be unavailable")}};return d?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Verifying authentication..."})]})}):s?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"bg-white border-b border-gray-200 px-4 py-2 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"Admin authenticated"})]}),(0,r.jsx)("button",{onClick:()=>{localStorage.removeItem("adminToken"),i(!1),c("")},className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Logout"})]}),t]}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,r.jsx)("div",{className:"max-w-md w-full mx-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("div",{className:"inline-block p-3 bg-blue-100 rounded-full mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Enter admin password to access Knowledge Vault"})]}),(0,r.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Password"}),(0,r.jsx)("input",{id:"password",type:"password",value:o,onChange:e=>c(e.target.value),placeholder:"Enter admin password",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0,required:!0})]}),m&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:m}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Unlock"})]}),(0,r.jsx)("div",{className:"mt-6 text-center text-sm text-gray-500",children:(0,r.jsx)("p",{children:"This is the same password used for the System Health page"})})]})})})}},8489:function(e,t,s){"use strict";var r=s(58078),a=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,d=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function o(e,t,s){var r,n={},o=null,c=null;for(r in void 0!==s&&(o=""+s),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,r)&&!l.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===n[r]&&(n[r]=t[r]);return{$$typeof:a,type:e,key:o,ref:c,props:n,_owner:d.current}}t.Fragment=n,t.jsx=o,t.jsxs=o},37821:function(e,t,s){"use strict";e.exports=s(8489)},46179:function(e,t,s){e.exports=s(85353)}},function(e){e.O(0,[115,835,744],function(){return e(e.s=83080)}),_N_E=e.O()}]);