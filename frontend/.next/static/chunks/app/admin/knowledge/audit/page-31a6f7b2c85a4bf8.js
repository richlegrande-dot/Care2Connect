(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[987],{56499:function(e,t,s){Promise.resolve().then(s.bind(s,23692))},23692:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(37821),r=s(58078),n=s(46179),i=s(39052);function l(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),[s,l]=(0,r.useState)([]),[d,c]=(0,r.useState)(!0),[o,x]=(0,r.useState)(1),[m,u]=(0,r.useState)(1),[h,g]=(0,r.useState)(null),[p,y]=(0,r.useState)((null==t?void 0:t.get("action"))||""),[b,f]=(0,r.useState)((null==t?void 0:t.get("entityType"))||""),[j,v]=(0,r.useState)((null==t?void 0:t.get("entityId"))||"");(0,r.useEffect)(()=>{N(),w()},[o,p,b,j]);let N=async()=>{c(!0);try{let e=localStorage.getItem("adminToken"),t=new URLSearchParams({page:o.toString(),limit:"50",...p&&{action:p},...b&&{entityType:b},...j&&{entityId:j}}),s=await fetch("/api/admin/knowledge/audit?".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});if(s.ok){let e=await s.json();l(e.logs),u(e.pagination.pages)}}catch(e){console.error("Error fetching audit logs:",e)}finally{c(!1)}},w=async()=>{try{let e=localStorage.getItem("adminToken"),t=await fetch("/api/admin/knowledge/audit/stats/summary",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();g(e)}}catch(e){console.error("Error fetching audit stats:",e)}},k=e=>{switch(e){case"CREATE":return"bg-green-100 text-green-800";case"UPDATE":return"bg-blue-100 text-blue-800";case"DELETE":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,a.jsx)(i.t,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{onClick:()=>e.push("/admin/knowledge"),className:"text-sm text-blue-600 hover:text-blue-700 mb-2 flex items-center",children:"â† Back to Knowledge Vault"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Audit Logs"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"View all changes to knowledge sources and chunks"})]})})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[h&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow mb-6 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Audit Statistics"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:h.total}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Total Logs"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:h.byAction.create}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Creates"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:h.byAction.update}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Updates"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:h.byAction.delete}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Deletes"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-700 mb-1",children:["Sources: ",h.byEntityType.knowledgeSource]}),(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-700",children:["Chunks: ",h.byEntityType.knowledgeChunk]})]})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow mb-6 p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action"}),(0,a.jsxs)("select",{value:p,onChange:e=>{y(e.target.value),x(1)},className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"All Actions"}),(0,a.jsx)("option",{value:"CREATE",children:"Create"}),(0,a.jsx)("option",{value:"UPDATE",children:"Update"}),(0,a.jsx)("option",{value:"DELETE",children:"Delete"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Entity Type"}),(0,a.jsxs)("select",{value:b,onChange:e=>{f(e.target.value),x(1)},className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"All Types"}),(0,a.jsx)("option",{value:"KNOWLEDGE_SOURCE",children:"Knowledge Source"}),(0,a.jsx)("option",{value:"KNOWLEDGE_CHUNK",children:"Knowledge Chunk"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Entity ID"}),(0,a.jsx)("input",{type:"text",value:j,onChange:e=>{v(e.target.value),x(1)},placeholder:"Filter by entity ID...",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:d?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading audit logs..."})]}):0===s.length?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No audit logs found"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entity"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actor"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Details"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(t=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.createdAt).toLocaleString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(k(t.action)),children:t.action})}),(0,a.jsxs)("td",{className:"px-6 py-4 text-sm text-gray-900",children:[(0,a.jsx)("div",{className:"font-medium",children:t.entityType.replace("_"," ")}),(0,a.jsx)("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:t.entityId})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.actor}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:(0,a.jsx)("div",{className:"max-w-xs truncate",children:t.reason||"-"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>e.push("/admin/knowledge/audit/".concat(t.id)),className:"text-blue-600 hover:text-blue-900",children:"View"})})]},t.id))})]}),m>1&&(0,a.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200",children:[(0,a.jsx)("button",{onClick:()=>x(Math.max(1,o-1)),disabled:1===o,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["Page ",o," of ",m]}),(0,a.jsx)("button",{onClick:()=>x(Math.min(m,o+1)),disabled:o===m,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})]})})]})]})})}},39052:function(e,t,s){"use strict";s.d(t,{t:function(){return i}});var a=s(37821),r=s(58078),n=s(46179);function i(e){let{children:t}=e,[s,i]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!0),[c,o]=(0,r.useState)(""),[x,m]=(0,r.useState)("");(0,n.useRouter)(),(0,r.useEffect)(()=>{let e=localStorage.getItem("adminToken");e?u(e):d(!1)},[]);let u=async e=>{try{let t=await fetch("/api/admin/db/connection-info",{headers:{Authorization:"Bearer ".concat(e)}});t.ok?i(!0):localStorage.removeItem("adminToken")}catch(e){i(!0)}finally{d(!1)}},h=async e=>{e.preventDefault(),m("");try{let e=await fetch("/api/admin/db/connection-info",{headers:{Authorization:"Bearer ".concat(c)}});e.ok?(localStorage.setItem("adminToken",c),i(!0),o("")):m("Invalid admin password")}catch(e){m("Authentication failed - server may be unavailable")}};return l?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Verifying authentication..."})]})}):s?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"bg-white border-b border-gray-200 px-4 py-2 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Admin authenticated"})]}),(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("adminToken"),i(!1),o("")},className:"text-sm text-gray-600 hover:text-gray-900 underline",children:"Logout"})]}),t]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,a.jsx)("div",{className:"max-w-md w-full mx-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"inline-block p-3 bg-blue-100 rounded-full mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Enter admin password to access Knowledge Vault"})]}),(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Password"}),(0,a.jsx)("input",{id:"password",type:"password",value:c,onChange:e=>o(e.target.value),placeholder:"Enter admin password",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0,required:!0})]}),x&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:x}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Unlock"})]}),(0,a.jsx)("div",{className:"mt-6 text-center text-sm text-gray-500",children:(0,a.jsx)("p",{children:"This is the same password used for the System Health page"})})]})})})}},8489:function(e,t,s){"use strict";var a=s(58078),r=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var a,n={},c=null,o=null;for(a in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(o=t.ref),t)i.call(t,a)&&!d.hasOwnProperty(a)&&(n[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===n[a]&&(n[a]=t[a]);return{$$typeof:r,type:e,key:c,ref:o,props:n,_owner:l.current}}t.Fragment=n,t.jsx=c,t.jsxs=c},37821:function(e,t,s){"use strict";e.exports=s(8489)},46179:function(e,t,s){e.exports=s(85353)}},function(e){e.O(0,[115,835,744],function(){return e(e.s=56499)}),_N_E=e.O()}]);