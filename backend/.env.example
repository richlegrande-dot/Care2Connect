# Environment Variables for CareConnect
# Copy this to .env and fill in your actual values
# SECURITY: Never commit actual secrets to git

# ============================================================================
# CORE APPLICATION SETTINGS
# ============================================================================

# Runtime Environment
NODE_ENV=development                # development | production | test
RUN_MODE=dev                        # dev | prod (explicit runtime mode)
PORT=3001

# Security
JWT_SECRET=your-super-secret-jwt-key-minimum-32-characters-required-for-security
SYSTEM_PANEL_PASSWORD=blueberry:y22

# ============================================================================
# V1 STABLE MODE FLAGS (REQUIRED FOR PRODUCTION)
# ============================================================================

# V1 Stable Mode - Enforces production-ready configuration
V1_STABLE=true

# Zero OpenAI Mode - Disables all OpenAI API calls (V1 requirement)
ZERO_OPENAI_MODE=true

# V2 Intake Wizard - Enable Coordinated Entry-style intake system
# When true, /api/v2/intake/* endpoints are active
ENABLE_V2_INTAKE=false

# AI Provider - Use 'rules' for deterministic rules-based processing
# Options: rules | none | openai (openai not allowed in V1)
AI_PROVIDER=rules

# Transcription Provider - AssemblyAI or stub for testing
# Options: assemblyai | stub | openai (openai not allowed in V1)
TRANSCRIPTION_PROVIDER=assemblyai
TRANSCRIPTION_PREFERENCE=assemblyai  # Legacy fallback

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# Database Mode - REQUIRED: Explicitly choose local or remote database
# DB_MODE=local   -> Use Docker PostgreSQL on localhost (recommended for dev)
# DB_MODE=remote  -> Use cloud/remote database (for production deployments)
DB_MODE=local

# Database URL
# For DB_MODE=local:  postgresql://username:password@localhost:5432/careconnect
# For DB_MODE=remote: postgresql://user:pass@db.prisma.io:5432/postgres
# DATABASE_URL=postgresql://username:password@localhost:5432/careconnect

# Health Check Configuration
HEALTHCHECKS_ENABLED=true
HEALTHCHECKS_INTERVAL_SEC=300

# Frontend URL (for CORS)
FRONTEND_URL=https://care2connects.org

# Legacy Configuration
ALLOW_SYSTEM_COMMANDS=false
KEYS_MANUAL_CONFIRM=true
# KEYS_VALIDATED=true

# Stripe (DO NOT PASTE REAL KEYS INTO PRs OR CHAT)
# To enable Stripe features (donations, webhook verification) set these to your Stripe account keys.
# Use test keys for local development (sk_test_..., pk_test_..., whsec_...)
# STRIPE_SECRET_KEY=
# STRIPE_PUBLISHABLE_KEY=
# STRIPE_WEBHOOK_SECRET=

# EVTS transcription model
# The project provides a helper script to install or prepare the EVTS model used for on-device
# transcription. Run the installer from the backend directory when you want full transcription support:
#   cd backend && npm run evts:model:install
# If you do not install the EVTS model, the server will fall back to browser NVT or a manual workflow.

# Optional runtime flags (examples)
# NO_KEYS_MODE=true           # enable reduced feature mode that avoids requiring secrets
# DEMO_SAFE_MODE=false        # auto-select ports and display demo banner when true

# Notes
# - Never paste real secrets into issue trackers or chat. Use local .env only.
# - After setting Stripe keys, set KEYS_VALIDATED=true (recommended) so the server will start.
# - If you want the server to run system preflight checks (cloudflared, stripe CLI), set ALLOW_SYSTEM_COMMANDS=true
#   only in a trusted local environment.
# CareConnect Backend Environment Variables
# Copy this file to .env and fill in your actual values

# Server Configuration
NODE_ENV=development
PORT=3001
FRONTEND_URL=http://localhost:3000

# Database Configuration (if using)
DATABASE_URL="your_database_connection_string"

# OpenAI Configuration (V2-ONLY - not used in V1_STABLE mode)
# When V1_STABLE=true or ZERO_OPENAI_MODE=true, OpenAI is completely disabled
OPENAI_API_KEY=your_openai_api_key_here

# Transcription Configuration
# EVTS-first reduces costs: EVTS (local, $0) â†’ fallback to OpenAI ($0.006/min)
TRANSCRIPTION_PREFERENCE=EVTS_FIRST  # Options: EVTS_FIRST, OPENAI_ONLY
EVTS_VARIANT=WHISPER                 # Options: WHISPER (accurate), VOSK (fast)

# Stripe Configuration
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# JWT Configuration
JWT_SECRET=your_jwt_secret_key_here

# System panel password (used when JWT_SECRET not provided). Keep this secret locally.
SYSTEM_PANEL_PASSWORD=blueberry:y22

# Optional public URL (production or cloudflare tunnel) to compute webhook endpoints
# PUBLIC_URL=https://example.com

# File Upload Configuration
MAX_FILE_SIZE=10485760
ALLOWED_FILE_TYPES=audio/wav,audio/mp3,audio/webm,audio/ogg

# API Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Logging
LOG_LEVEL=info

# Demo Mode (set to true for demo environments)
DEMO_MODE=false

# Data Protection Settings
BLOCK_SENSITIVE_DATA=true
REQUIRE_CONSENT=true

# CORS Configuration
CORS_ORIGIN=http://localhost:3000

# Session Configuration
SESSION_SECRET=your_session_secret_here

# Storage Configuration (optional - for file uploads)
STORAGE_PROVIDER=local
STORAGE_PATH=./uploads

# Transcription Configuration (Speech Analyzer v2)
TRANSCRIPTION_MODE=legacy
# Options: legacy (OpenAI API), nvt (Native Voice Transcription - Web Speech API), evts (Extended Voice Transcription Service - offline)

# EVTS Configuration (if TRANSCRIPTION_MODE=evts)
EVTS_ENGINE=whispercpp
# Options: whispercpp, vosk
EVTS_MODEL_PATH=./models/whisper.cpp/ggml-base.en.bin
TRANSCRIPTION_LANGUAGE=en-US

# Support Ticket Configuration
SUPPORT_EMAIL_TO=workflown8n@gmail.com
# NOTE: SMTP/email delivery support has been archived and removed from
# active validation. Support tickets are written to `data/support-tickets`
# and surfaced on the admin health pages. If you require SMTP in the
# future, restore the relevant variables from git history.

# GoFundMe API (if integrating directly)
GOFUNDME_API_KEY=
GOFUNDME_API_SECRET=

# QR Code Configuration
QR_CODE_SIZE=200
QR_CODE_MARGIN=4
QR_CODE_ERROR_LEVEL=M

# Document Export Configuration
EXPORT_TEMPLATE_PATH=./templates
DEFAULT_FONT_FAMILY="Arial"
DEFAULT_FONT_SIZE=12

# Health Check Configuration
HEALTH_CHECK_INTERVAL=30000
EXTERNAL_SERVICE_TIMEOUT=5000

# Development/Testing
MOCK_OPENAI_RESPONSES=false
MOCK_STRIPE_RESPONSES=false

# ===========================
# Phase 6C: Pipeline Timeouts & Retry Configuration
# ===========================

# Pipeline Stage Timeouts (milliseconds)
TRANSCRIPTION_TIMEOUT=120000          # 2 minutes for AssemblyAI
ANALYSIS_TIMEOUT=10000                # 10 seconds for keyword extraction
DRAFT_GENERATION_TIMEOUT=15000        # 15 seconds for draft creation
QR_GENERATION_TIMEOUT=10000           # 10 seconds for QR + Stripe
PIPELINE_TOTAL_TIMEOUT=180000         # 3 minutes total pipeline timeout

# Retry Settings
MAX_RETRY_ATTEMPTS=3
RETRY_INITIAL_DELAY=2000              # 2 seconds
RETRY_MAX_DELAY=30000                 # 30 seconds
RETRY_BACKOFF_MULTIPLIER=2

# Circuit Breaker Settings
CIRCUIT_BREAKER_THRESHOLD=5           # Failures before circuit opens
CIRCUIT_BREAKER_RESET_TIMEOUT=60000   # 1 minute before trying again
DISABLE_RATE_LIMITING=false