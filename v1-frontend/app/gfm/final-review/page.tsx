'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\n\ninterface GoFundMeDraft {\n  title: string;\n  story: string;\n  goal: number;\n  category: string;\n  instructions: string[];\n  created_at: string;\n  disclaimer: string;\n}\n\nexport default function FinalReviewPage() {\n  const [draft, setDraft] = useState<GoFundMeDraft | null>(null)\n  const [qrCodeUrl, setQrCodeUrl] = useState('')\n  const [donationUrl, setDonationUrl] = useState('')\n\n  useEffect(() => {\n    // Load draft from localStorage\n    const savedDraft = localStorage.getItem('gfm_final_draft')\n    if (savedDraft) {\n      setDraft(JSON.parse(savedDraft))\n    }\n  }, [])\n\n  const generateQRForDraft = async () => {\n    if (!donationUrl.trim()) {\n      alert('Please enter a donation URL first')\n      return\n    }\n    \n    try {\n      const response = await fetch('http://localhost:3001/api/donations/qr', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          donation_url: donationUrl\n        })\n      })\n      \n      if (response.ok) {\n        const result = await response.json()\n        setQrCodeUrl(result.qr_code_url)\n      } else {\n        alert('Failed to generate QR code')\n      }\n    } catch (error) {\n      console.error('Error generating QR code:', error)\n      alert('Error generating QR code. Make sure the backend server is running.')\n    }\n  }\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text)\n    alert('Copied to clipboard!')\n  }\n\n  const downloadPDF = () => {\n    // For V1, we'll create a simple text file instead of PDF\n    const content = `\nCareConnect GoFundMe Draft Package\n=================================\n\nTitle: ${draft?.title}\n\nStory:\n${draft?.story}\n\nGoal: $${draft?.goal?.toLocaleString()}\n\nCategory: ${draft?.category}\n\nInstructions:\n${draft?.instructions?.map((instruction, index) => `${index + 1}. ${instruction}`).join('\\n')}\n\nGenerated: ${new Date().toLocaleString()}\n\nDisclaimer: ${draft?.disclaimer}\n`\n    \n    const blob = new Blob([content], { type: 'text/plain' })\n    const url = URL.createObjectURL(blob)\n    const link = document.createElement('a')\n    link.href = url\n    link.download = 'gofundme-draft-package.txt'\n    link.click()\n    URL.revokeObjectURL(url)\n  }\n\n  const restartProcess = () => {\n    // Clear all localStorage data\n    const keys = ['gfm_location', 'gfm_category', 'gfm_beneficiary', 'gfm_media', 'gfm_story', 'gfm_goal', 'gfm_final_draft']\n    keys.forEach(key => localStorage.removeItem(key))\n  }\n\n  if (!draft) {\n    return (\n      <div className=\"max-w-2xl mx-auto\">\n        <div className=\"card text-center\">\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">No Draft Found</h1>\n          <p className=\"text-gray-600 mb-6\">Please complete the GoFundMe setup process first.</p>\n          <Link href=\"/gfm/1-location\" className=\"btn-primary\">\n            Start GoFundMe Setup\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto\">\n      <div className=\"text-center mb-8\">\n        <h1 className=\"text-3xl font-bold text-green-600 mb-2\">ğŸ‰ Draft Package Complete!</h1>\n        <p className=\"text-gray-600\">Your GoFundMe draft is ready. Follow the instructions below to set up your official campaign.</p>\n      </div>\n\n      <div className=\"grid md:grid-cols-2 gap-8\">\n        {/* Left Column - Draft Content */}\n        <div>\n          {/* Title and Story */}\n          <div className=\"card mb-6\">\n            <h2 className=\"text-xl font-bold text-gray-900 mb-4\">ğŸ“ Your GoFundMe Draft</h2>\n            \n            <div className=\"mb-4\">\n              <label className=\"text-sm font-medium text-gray-700\">Title:</label>\n              <div className=\"mt-1 p-3 bg-gray-50 rounded border\">\n                <p className=\"font-medium\">{draft.title}</p>\n                <button \n                  onClick={() => copyToClipboard(draft.title)}\n                  className=\"text-xs text-blue-600 hover:underline mt-1\"\n                >\n                  ğŸ“‹ Copy Title\n                </button>\n              </div>\n            </div>\n\n            <div className=\"mb-4\">\n              <label className=\"text-sm font-medium text-gray-700\">Story:</label>\n              <div className=\"mt-1 p-3 bg-gray-50 rounded border max-h-64 overflow-y-auto\">\n                <p className=\"whitespace-pre-wrap text-sm\">{draft.story}</p>\n                <button \n                  onClick={() => copyToClipboard(draft.story)}\n                  className=\"text-xs text-blue-600 hover:underline mt-2\"\n                >\n                  ğŸ“‹ Copy Story\n                </button>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium text-gray-700\">Goal:</label>\n                <div className=\"mt-1 p-2 bg-gray-50 rounded border\">\n                  <p className=\"font-bold text-green-600\">${draft.goal.toLocaleString()}</p>\n                </div>\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-gray-700\">Category:</label>\n                <div className=\"mt-1 p-2 bg-gray-50 rounded border\">\n                  <p className=\"capitalize\">{draft.category}</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Instructions */}\n          <div className=\"card\">\n            <h2 className=\"text-xl font-bold text-gray-900 mb-4\">ğŸ“‹ Setup Instructions</h2>\n            <div className=\"space-y-2\">\n              {draft.instructions.map((instruction, index) => (\n                <div key={index} className=\"flex items-start\">\n                  <span className=\"bg-blue-100 text-blue-600 text-xs font-medium px-2 py-1 rounded mr-3 mt-1\">\n                    {index + 1}\n                  </span>\n                  <p className=\"text-gray-700\">{instruction}</p>\n                </div>\n              ))}\n            </div>\n            \n            <div className=\"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded\">\n              <div className=\"flex items-center\">\n                <span className=\"text-xl mr-2\">ğŸ”—</span>\n                <a \n                  href=\"https://www.gofundme.com/sign-up\" \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"text-blue-600 font-medium hover:underline\"\n                >\n                  Open GoFundMe Setup â†’\n                </a>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Right Column - QR Code and Actions */}\n        <div>\n          {/* QR Code Generator */}\n          <div className=\"card mb-6\">\n            <h2 className=\"text-xl font-bold text-gray-900 mb-4\">ğŸ“± QR Code for Instant Donations</h2>\n            \n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Donation URL (Cash App, Venmo, etc.)\n              </label>\n              <input\n                type=\"text\"\n                value={donationUrl}\n                onChange={(e) => setDonationUrl(e.target.value)}\n                placeholder=\"https://cash.app/$username\"\n                className=\"form-input mb-3\"\n              />\n              <button onClick={generateQRForDraft} className=\"btn-primary w-full\">\n                ğŸ“± Generate QR Code\n              </button>\n            </div>\n\n            {qrCodeUrl && (\n              <div className=\"text-center bg-green-50 p-4 rounded\">\n                <img src={qrCodeUrl} alt=\"Donation QR Code\" className=\"w-32 h-32 mx-auto mb-3\" />\n                <p className=\"text-sm text-green-800\">âœ… QR Code ready for instant donations!</p>\n              </div>\n            )}\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"card\">\n            <h2 className=\"text-xl font-bold text-gray-900 mb-4\">ğŸ’¾ Download & Share</h2>\n            <div className=\"space-y-3\">\n              <button onClick={downloadPDF} className=\"btn-primary w-full\">\n                ğŸ“„ Download Complete Package\n              </button>\n              <button \n                onClick={() => copyToClipboard(`${draft.title}\\n\\n${draft.story}\\n\\nGoal: $${draft.goal.toLocaleString()}`)}\n                className=\"btn-secondary w-full\"\n              >\n                ğŸ“‹ Copy All Text\n              </button>\n              <Link href=\"/\" onClick={restartProcess} className=\"btn-secondary w-full block text-center\">\n                ğŸ”„ Start New Campaign\n              </Link>\n            </div>\n          </div>\n\n          {/* Disclaimer */}\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n            <div className=\"flex\">\n              <span className=\"text-red-400 text-xl mr-2\">âš ï¸</span>\n              <div>\n                <h3 className=\"text-sm font-medium text-red-900 mb-1\">Important Disclaimer</h3>\n                <p className=\"text-xs text-red-800\">{draft.disclaimer}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}