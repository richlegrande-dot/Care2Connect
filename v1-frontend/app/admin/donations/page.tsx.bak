'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\n\ninterface Donation {\n  id: string;\n  clientSlug: string;\n  amountCents: number;\n  status: string;\n  stripeSessionId?: string;\n  stripePaymentId?: string;\n  donorEmail?: string;\n  donorName?: string;\n  createdAt: string;\n}\n\nexport default function AdminDonationsPage() {\n  const [donations, setDonations] = useState<Donation[]>([])\n  const [loading, setLoading] = useState(true)\n  const [filter, setFilter] = useState('')\n  const [statusFilter, setStatusFilter] = useState('all')\n  const [stats, setStats] = useState({\n    total: 0,\n    totalAmount: 0,\n    succeeded: 0,\n    pending: 0,\n    failed: 0\n  })\n\n  useEffect(() => {\n    loadDonations()\n  }, [])\n\n  const loadDonations = async () => {\n    try {\n      setLoading(true)\n      // For V1, we'll use mock data since we don't have a full backend endpoint\n      // In production, this would be: const response = await fetch('/api/admin/donations')\n      \n      // Mock data for demonstration\n      const mockDonations: Donation[] = [\n        {\n          id: '1',\n          clientSlug: 'marcus-123',\n          amountCents: 2500,\n          status: 'succeeded',\n          stripeSessionId: 'cs_test_123',\n          stripePaymentId: 'pi_test_123',\n          donorEmail: 'donor@example.com',\n          donorName: 'John Smith',\n          createdAt: new Date().toISOString()\n        },\n        {\n          id: '2',\n          clientSlug: 'sarah-456',\n          amountCents: 5000,\n          status: 'succeeded',\n          stripeSessionId: 'cs_test_456',\n          stripePaymentId: 'pi_test_456',\n          donorEmail: 'helper@example.com',\n          donorName: 'Jane Doe',\n          createdAt: new Date(Date.now() - 86400000).toISOString()\n        },\n        {\n          id: '3',\n          clientSlug: 'alex-789',\n          amountCents: 1000,\n          status: 'pending',\n          stripeSessionId: 'cs_test_789',\n          createdAt: new Date(Date.now() - 3600000).toISOString()\n        }\n      ]\n      \n      setDonations(mockDonations)\n      \n      // Calculate stats\n      const total = mockDonations.length\n      const totalAmount = mockDonations\n        .filter(d => d.status === 'succeeded')\n        .reduce((sum, d) => sum + d.amountCents, 0) / 100\n      const succeeded = mockDonations.filter(d => d.status === 'succeeded').length\n      const pending = mockDonations.filter(d => d.status === 'pending').length\n      const failed = mockDonations.filter(d => d.status === 'failed').length\n      \n      setStats({ total, totalAmount, succeeded, pending, failed })\n      \n    } catch (error) {\n      console.error('Failed to load donations:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const filteredDonations = donations.filter(donation => {\n    const matchesFilter = donation.clientSlug.toLowerCase().includes(filter.toLowerCase()) ||\n                         donation.donorEmail?.toLowerCase().includes(filter.toLowerCase()) ||\n                         donation.donorName?.toLowerCase().includes(filter.toLowerCase())\n    \n    const matchesStatus = statusFilter === 'all' || donation.status === statusFilter\n    \n    return matchesFilter && matchesStatus\n  })\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'succeeded': return 'text-green-600 bg-green-100'\n      case 'pending': return 'text-yellow-600 bg-yellow-100'\n      case 'failed': return 'text-red-600 bg-red-100'\n      default: return 'text-gray-600 bg-gray-100'\n    }\n  }\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleString()\n  }\n\n  const formatAmount = (amountCents: number) => {\n    return `$${(amountCents / 100).toFixed(2)}`\n  }\n\n  if (loading) {\n    return (\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"card text-center\">\n          <div className=\"animate-pulse\">\n            <div className=\"h-8 bg-gray-300 rounded mb-4\"></div>\n            <div className=\"h-4 bg-gray-300 rounded mb-2\"></div>\n            <div className=\"h-4 bg-gray-300 rounded\"></div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n          üí∞ Donation Dashboard\n        </h1>\n        <p className=\"text-gray-600\">\n          Monitor and manage donations across all CareConnect clients\n        </p>\n        \n        {/* Navigation Links */}\n        <div className=\"flex space-x-4 mt-4\">\n          <Link href=\"/admin/donations/ledger\" className=\"btn-secondary\">\n            üìä Donation Ledger\n          </Link>\n          <Link href=\"/admin/donations/statements\" className=\"btn-secondary\">\n            üìÑ Donor Statements\n          </Link>\n        </div>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n        <div className=\"card text-center\">\n          <div className=\"text-2xl font-bold text-blue-600\">{stats.total}</div>\n          <div className=\"text-sm text-gray-600\">Total Donations</div>\n        </div>\n        <div className=\"card text-center\">\n          <div className=\"text-2xl font-bold text-green-600\">${stats.totalAmount.toFixed(2)}</div>\n          <div className=\"text-sm text-gray-600\">Total Raised</div>\n        </div>\n        <div className=\"card text-center\">\n          <div className=\"text-2xl font-bold text-green-600\">{stats.succeeded}</div>\n          <div className=\"text-sm text-gray-600\">Successful</div>\n        </div>\n        <div className=\"card text-center\">\n          <div className=\"text-2xl font-bold text-yellow-600\">{stats.pending}</div>\n          <div className=\"text-sm text-gray-600\">Pending</div>\n        </div>\n      </div>\n\n      {/* Filters */}\n      <div className=\"card mb-6\">\n        <div className=\"flex flex-col md:flex-row gap-4\">\n          <div className=\"flex-1\">\n            <input\n              type=\"text\"\n              placeholder=\"Search by client, donor name, or email...\"\n              value={filter}\n              onChange={(e) => setFilter(e.target.value)}\n              className=\"form-input\"\n            />\n          </div>\n          <div>\n            <select\n              value={statusFilter}\n              onChange={(e) => setStatusFilter(e.target.value)}\n              className=\"form-input\"\n            >\n              <option value=\"all\">All Statuses</option>\n              <option value=\"succeeded\">Succeeded</option>\n              <option value=\"pending\">Pending</option>\n              <option value=\"failed\">Failed</option>\n            </select>\n          </div>\n          <div>\n            <button\n              onClick={loadDonations}\n              className=\"btn-secondary whitespace-nowrap\"\n            >\n              üîÑ Refresh\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Donations Table */}\n      <div className=\"card\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead>\n              <tr className=\"border-b\">\n                <th className=\"text-left p-3 font-medium text-gray-700\">Client</th>\n                <th className=\"text-left p-3 font-medium text-gray-700\">Amount</th>\n                <th className=\"text-left p-3 font-medium text-gray-700\">Status</th>\n                <th className=\"text-left p-3 font-medium text-gray-700\">Donor</th>\n                <th className=\"text-left p-3 font-medium text-gray-700\">Date</th>\n                <th className=\"text-left p-3 font-medium text-gray-700\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredDonations.length === 0 ? (\n                <tr>\n                  <td colSpan={6} className=\"p-8 text-center text-gray-500\">\n                    No donations found matching your criteria\n                  </td>\n                </tr>\n              ) : (\n                filteredDonations.map((donation) => (\n                  <tr key={donation.id} className=\"border-b hover:bg-gray-50\">\n                    <td className=\"p-3\">\n                      <div className=\"font-medium text-gray-900\">{donation.clientSlug}</div>\n                      <div className=\"text-sm text-gray-500\">ID: {donation.id}</div>\n                    </td>\n                    <td className=\"p-3\">\n                      <div className=\"font-medium text-gray-900\">\n                        {formatAmount(donation.amountCents)}\n                      </div>\n                    </td>\n                    <td className=\"p-3\">\n                      <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(donation.status)}`}>\n                        {donation.status}\n                      </span>\n                    </td>\n                    <td className=\"p-3\">\n                      {donation.donorName ? (\n                        <div>\n                          <div className=\"font-medium text-gray-900\">{donation.donorName}</div>\n                          <div className=\"text-sm text-gray-500\">{donation.donorEmail}</div>\n                        </div>\n                      ) : (\n                        <span className=\"text-gray-400\">Anonymous</span>\n                      )}\n                    </td>\n                    <td className=\"p-3\">\n                      <div className=\"text-sm text-gray-900\">\n                        {formatDate(donation.createdAt)}\n                      </div>\n                    </td>\n                    <td className=\"p-3\">\n                      <div className=\"flex space-x-2\">\n                        <Link\n                          href={`/donate/${donation.clientSlug}`}\n                          className=\"text-blue-600 hover:text-blue-800 text-sm\"\n                        >\n                          View Page\n                        </Link>\n                        {donation.stripeSessionId && (\n                          <button className=\"text-gray-600 hover:text-gray-800 text-sm\">\n                            View Details\n                          </button>\n                        )}\n                      </div>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Navigation */}\n      <div className=\"flex justify-between items-center mt-8\">\n        <Link href=\"/\" className=\"btn-secondary\">\n          ‚Üê Back to Home\n        </Link>\n        \n        <div className=\"space-x-4\">\n          <button className=\"btn-secondary\">\n            üìä Export Report\n          </button>\n          <button className=\"btn-primary\">\n            ‚öôÔ∏è Settings\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}