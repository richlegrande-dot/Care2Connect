'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\n\ninterface FormData {\n  location?: { country: string; zipCode: string };\n  category?: string;\n  beneficiary?: { type: string; name: string };\n  media?: { hasMedia: boolean };\n  story?: { title: string; story: string };\n  goal?: string;\n}\n\nexport default function ReviewPage() {\n  const router = useRouter()\n  const [formData, setFormData] = useState<FormData>({})\n  const [isGenerating, setIsGenerating] = useState(false)\n\n  useEffect(() => {\n    // Load all form data from localStorage\n    const location = localStorage.getItem('gfm_location')\n    const category = localStorage.getItem('gfm_category')\n    const beneficiary = localStorage.getItem('gfm_beneficiary')\n    const media = localStorage.getItem('gfm_media')\n    const story = localStorage.getItem('gfm_story')\n    const goal = localStorage.getItem('gfm_goal')\n\n    setFormData({\n      location: location ? JSON.parse(location) : null,\n      category: category || null,\n      beneficiary: beneficiary ? JSON.parse(beneficiary) : null,\n      media: media ? JSON.parse(media) : null,\n      story: story ? JSON.parse(story) : null,\n      goal: goal || null\n    })\n  }, [])\n\n  const generateDraft = async () => {\n    setIsGenerating(true)\n    \n    try {\n      const response = await fetch('http://localhost:3001/api/gofundme/draft', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          name: formData.beneficiary?.name || 'Anonymous',\n          summary: formData.story?.story || '',\n          category: formData.category || 'Emergency',\n          goal: formData.goal || '5000'\n        })\n      })\n      \n      if (response.ok) {\n        const draft = await response.json()\n        localStorage.setItem('gfm_final_draft', JSON.stringify(draft))\n        router.push('/gfm/final-review')\n      } else {\n        alert('Failed to generate draft. Please try again.')\n      }\n    } catch (error) {\n      console.error('Error generating draft:', error)\n      alert('Error generating draft. Make sure the backend server is running.')\n    } finally {\n      setIsGenerating(false)\n    }\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      {/* Progress Bar */}\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between text-sm text-gray-500 mb-2\">\n          <span>Step 7 of 7</span>\n          <span>Review</span>\n        </div>\n        <div className=\"w-full bg-gray-200 rounded-full h-2\">\n          <div className=\"bg-blue-600 h-2 rounded-full\" style={{width: '100%'}}></div>\n        </div>\n      </div>\n\n      <div className=\"card\">\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-6\">\n          Review your fundraiser\n        </h1>\n        <p className=\"text-gray-600 mb-8\">\n          Review all the details before we generate your GoFundMe draft package.\n        </p>\n\n        {/* Review Sections */}\n        <div className=\"space-y-6\">\n          {/* Location */}\n          <div className=\"border rounded-lg p-4\">\n            <h3 className=\"font-medium text-gray-900 mb-2\">üìç Location</h3>\n            <p className=\"text-gray-600\">\n              {formData.location?.country}, {formData.location?.zipCode}\n            </p>\n            <Link href=\"/gfm/1-location\" className=\"text-blue-600 text-sm underline\">\n              Edit location\n            </Link>\n          </div>\n\n          {/* Category */}\n          <div className=\"border rounded-lg p-4\">\n            <h3 className=\"font-medium text-gray-900 mb-2\">üè∑Ô∏è Category</h3>\n            <p className=\"text-gray-600 capitalize\">{formData.category}</p>\n            <Link href=\"/gfm/2-category\" className=\"text-blue-600 text-sm underline\">\n              Edit category\n            </Link>\n          </div>\n\n          {/* Beneficiary */}\n          <div className=\"border rounded-lg p-4\">\n            <h3 className=\"font-medium text-gray-900 mb-2\">üë§ Beneficiary</h3>\n            <p className=\"text-gray-600\">\n              {formData.beneficiary?.type === 'yourself' ? 'Yourself' : formData.beneficiary?.name}\n            </p>\n            <Link href=\"/gfm/3-beneficiary\" className=\"text-blue-600 text-sm underline\">\n              Edit beneficiary\n            </Link>\n          </div>\n\n          {/* Media */}\n          <div className=\"border rounded-lg p-4\">\n            <h3 className=\"font-medium text-gray-900 mb-2\">üì∑ Media</h3>\n            <p className=\"text-gray-600\">\n              {formData.media?.hasMedia ? 'Media uploaded' : 'No media added'}\n            </p>\n            <Link href=\"/gfm/4-media\" className=\"text-blue-600 text-sm underline\">\n              Edit media\n            </Link>\n          </div>\n\n          {/* Story */}\n          <div className=\"border rounded-lg p-4\">\n            <h3 className=\"font-medium text-gray-900 mb-2\">üìù Your Story</h3>\n            <p className=\"font-medium text-gray-900 mb-1\">{formData.story?.title}</p>\n            <p className=\"text-gray-600 text-sm line-clamp-3\">\n              {formData.story?.story?.substring(0, 150)}...\n            </p>\n            <Link href=\"/gfm/5-story\" className=\"text-blue-600 text-sm underline\">\n              Edit story\n            </Link>\n          </div>\n\n          {/* Goal */}\n          <div className=\"border rounded-lg p-4\">\n            <h3 className=\"font-medium text-gray-900 mb-2\">üí∞ Goal</h3>\n            <p className=\"text-gray-600 text-2xl font-bold\">\n              ${parseInt(formData.goal || '0').toLocaleString()}\n            </p>\n            <Link href=\"/gfm/6-goal\" className=\"text-blue-600 text-sm underline\">\n              Edit goal\n            </Link>\n          </div>\n        </div>\n\n        {/* Final Steps */}\n        <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-8\">\n          <h3 className=\"font-medium text-yellow-900 mb-2\">‚ö†Ô∏è Next Steps</h3>\n          <p className=\"text-yellow-800 text-sm mb-2\">\n            After clicking \"Generate Draft\", we'll create your complete GoFundMe package with:\n          </p>\n          <ul className=\"text-yellow-800 text-sm space-y-1 ml-4\">\n            <li>‚Ä¢ Complete title and story text</li>\n            <li>‚Ä¢ Step-by-step GoFundMe setup instructions</li>\n            <li>‚Ä¢ QR code for instant donations</li>\n            <li>‚Ä¢ Downloadable draft package</li>\n          </ul>\n        </div>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between items-center pt-6 border-t mt-8\">\n          <Link href=\"/gfm/6-goal\" className=\"btn-secondary\">\n            ‚Üê Back\n          </Link>\n          \n          <button \n            onClick={generateDraft}\n            disabled={isGenerating}\n            className={`btn-primary ${isGenerating ? 'opacity-50 cursor-not-allowed' : ''}`}\n          >\n            {isGenerating ? '‚è≥ Generating...' : 'üöÄ Generate Draft Package'}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}