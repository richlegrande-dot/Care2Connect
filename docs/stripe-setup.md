# Stripe Setup Guide for CareConnect V1.5\n\n## üéØ Overview\n\nCareConnect V1.5 integrates Stripe Checkout to enable secure card donations. This guide walks you through setting up your Stripe account and configuring the necessary API keys.\n\n## üìã Prerequisites\n\n- A CareConnect V1.5 installation\n- Access to your server environment variables\n- A valid email address for Stripe account creation\n\n## üè¶ Step 1: Create Your Stripe Account\n\n### For New Users:\n\n1. **Visit Stripe**: Go to [https://stripe.com](https://stripe.com)\n2. **Click \"Start now\"** or **\"Sign up\"**\n3. **Enter your details**:\n   - Email address\n   - Full name\n   - Password\n   - Country\n4. **Verify your email** by clicking the link sent to your inbox\n5. **Complete business information** (can be done later for testing)\n\n### For Existing Users:\n\n1. **Sign in** at [https://dashboard.stripe.com](https://dashboard.stripe.com)\n2. **Navigate to your dashboard**\n\n## üîë Step 2: Get Your API Keys\n\n### Test Keys (for development):\n\n1. **In your Stripe Dashboard**, ensure you're in **\"Test mode\"** (toggle in top-left)\n2. **Go to** `Developers` ‚Üí `API Keys` in the left sidebar\n3. **Copy your keys**:\n   - **Publishable key**: Starts with `pk_test_...`\n   - **Secret key**: Starts with `sk_test_...` (click \"Reveal live key\" to show)\n\n### Live Keys (for production):\n\n1. **Complete account verification** (add business details, bank account)\n2. **Toggle to \"Live mode\"** in the dashboard\n3. **Go to** `Developers` ‚Üí `API Keys`\n4. **Copy your live keys**:\n   - **Publishable key**: Starts with `pk_live_...`\n   - **Secret key**: Starts with `sk_live_...`\n\n## ü™ù Step 3: Set Up Webhooks\n\n### Create Webhook Endpoint:\n\n1. **In Stripe Dashboard**, go to `Developers` ‚Üí `Webhooks`\n2. **Click \"Add endpoint\"**\n3. **Enter your endpoint URL**:\n   - **Development**: `http://localhost:3001/api/payments/stripe-webhook`\n   - **Production**: `https://yourdomain.com/api/payments/stripe-webhook`\n4. **Select events to listen for**:\n   - `checkout.session.completed` ‚úÖ **Required**\n   - `payment_intent.succeeded` (optional)\n   - `payment_intent.payment_failed` (optional)\n5. **Click \"Add endpoint\"**\n6. **Copy the webhook secret** (starts with `whsec_...`)\n\n## ‚öôÔ∏è Step 4: Configure Environment Variables\n\n### Backend Environment (.env):\n\nAdd these variables to your backend `.env` file:\n\n```bash\n# Stripe Configuration\nSTRIPE_SECRET_KEY=sk_test_your_secret_key_here\nSTRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here\n\n# App Configuration\nAPP_DOMAIN=http://localhost:3000\nNODE_ENV=development\n```\n\n### Frontend Environment (.env.local):\n\nAdd to your frontend `.env.local` file:\n\n```bash\n# Stripe Public Key (only needed if using Stripe Elements later)\nNEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your_publishable_key_here\n```\n\n## üß™ Step 5: Test Your Setup\n\n### Test Payment Flow:\n\n1. **Start your servers**:\n   ```bash\n   # Backend\n   cd v1-backend && npm start\n   \n   # Frontend  \n   cd v1-frontend && npm run dev\n   ```\n\n2. **Visit a donation page**: `http://localhost:3000/donate/test-client`\n\n3. **Try a test donation**:\n   - Enter any amount\n   - Click \"Donate with Card\"\n   - Use Stripe test card: `4242 4242 4242 4242`\n   - Any future expiry date\n   - Any 3-digit CVC\n   - Any billing details\n\n4. **Verify success**:\n   - Should redirect to success page\n   - Check backend logs for webhook confirmation\n   - Check Stripe Dashboard for payment\n\n### Test Cards:\n\n| Card Number | Description |\n|-------------|-------------|\n| `4242 4242 4242 4242` | Visa (succeeds) |\n| `4000 0000 0000 0002` | Card declined |\n| `4000 0000 0000 9995` | Insufficient funds |\n| `4000 0025 0000 3155` | Requires authentication |\n\n## üöÄ Step 6: Go Live (Production)\n\n### Before Going Live:\n\n1. **Complete Stripe account verification**\n2. **Add business bank account**\n3. **Update environment variables** with live keys\n4. **Update webhook URL** to production domain\n5. **Test thoroughly** in live mode\n\n### Production Checklist:\n\n- [ ] Live Stripe keys configured\n- [ ] Webhook endpoint accessible from internet\n- [ ] SSL certificate installed (https://)\n- [ ] Error handling tested\n- [ ] Backup and monitoring in place\n\n## üîß Troubleshooting\n\n### Common Issues:\n\n**\"Stripe not configured\" error**:\n- Check `STRIPE_SECRET_KEY` is set correctly\n- Restart your server after adding environment variables\n\n**Webhook signature verification failed**:\n- Verify `STRIPE_WEBHOOK_SECRET` matches the one in your Stripe dashboard\n- Check webhook URL is accessible\n- Ensure raw body is being passed to webhook handler\n\n**Donations not completing**:\n- Check webhook is receiving events\n- Verify database connection\n- Check server logs for errors\n\n**Test payments not working**:\n- Ensure you're in Stripe test mode\n- Use test card numbers only\n- Check API keys are test keys (`pk_test_`, `sk_test_`)\n\n### Debug Commands:\n\n```bash\n# Check environment variables\necho $STRIPE_SECRET_KEY\necho $STRIPE_WEBHOOK_SECRET\n\n# Test health endpoint\ncurl http://localhost:3001/health\n\n# Check webhook endpoint\ncurl -X POST http://localhost:3001/api/payments/stripe-webhook\n```\n\n## üìû Support\n\n- **Stripe Documentation**: [https://stripe.com/docs](https://stripe.com/docs)\n- **Stripe Support**: Available in your Stripe Dashboard\n- **CareConnect Issues**: Check the project repository\n\n## üîí Security Best Practices\n\n1. **Never commit API keys** to version control\n2. **Use environment variables** for all sensitive data\n3. **Verify webhook signatures** (implemented in code)\n4. **Use HTTPS** in production\n5. **Monitor for unusual activity** in Stripe Dashboard\n6. **Keep dependencies updated**\n\n---\n\n## Example .env Files\n\n### Backend .env (Development)\n```bash\n# Database\nDATABASE_URL=\"postgresql://username:password@localhost:5432/careconnect\"\n\n# Stripe\nSTRIPE_SECRET_KEY=sk_test_51ABcdef...\nSTRIPE_WEBHOOK_SECRET=whsec_1234567890abcdef...\n\n# App\nAPP_DOMAIN=http://localhost:3000\nNODE_ENV=development\nPORT=3001\n```\n\n### Frontend .env.local (Development)\n```bash\n# API\nNEXT_PUBLIC_API_URL=http://localhost:3001/api\n\n# Stripe (optional for V1.5)\nNEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51ABcdef...\n\n# App\nNEXT_PUBLIC_APP_DOMAIN=http://localhost:3000\n```\n\nAfter setting up these files, restart both your frontend and backend servers to apply the new configuration.